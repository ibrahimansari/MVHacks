(function(e){var t=-1;var n,r;var i=[];e.promin={key:{backspace:8,tab:9,enter:13,"return":13,shift:16,ctrl:17,alt:18,caps:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,del:46}};var s={ajaxCallback:null,autofocus:true,actions:{submit:"default"},events:{change:null,next:null,previous:null,submit:null,reset:null},shortcuts:{next:[e.promin.key.tab,e.promin.key.enter],previous:[[e.promin.key.tab,e.promin.key.shift]],reset:[e.promin.key.escape]}};var o={next:function(e){var n=t+1;if(u.eventIsSet("next",e)){if(s.events.next.call(this,n)===false)return}if(n===r.length)o.submit();else o.show(n)},previous:function(e){var n=t-1;if(u.eventIsSet("previous",e)){if(s.events.next.call(this,n)===false)return}if(n<0)return;o.show(n)},show:function(e,n,i){var o,a;if(u.eventIsSet("change",n)){if(s.events.change.call(this,e)===false)return}o=r.eq(t);a=u.getField(o);o.hide();a.blur();if(e<r.length){o=r.eq(e);a=u.getField(o);o.show();if(!i||s.autofocus)a.focus()}t=e},submit:function(t){var i;if(u.eventIsSet("submit",t)){i=r.find("input, textarea, select");if(s.events.submit.call(this,i)===false)return}if(s.actions.submit&&s.actions.submit==="default"){n.submit()}else if(s.actions.submit&&s.actions.submit==="ajax"){var o=n.attr("action");i=n.serialize();i.ajax=true;e.ajax({cache:false,complete:s.ajaxCallback,data:i,type:"POST",url:o})}},reset:function(e){o.show(0,false,true);r.find("input").each(u.resetInput);r.find("textarea").each(u.resetTextarea);r.find("select").each(u.resetSelect);if(u.eventIsSet("reset",e)){s.events.reset.call(this)}}};var u={init:function(t){e.extend(s,t);n=this;r=this.find(".pm-step");n.addClass("promin");r.hide().each(function(t,n){var r=e(n);var i=u.getField(r);i.keydown(u.keydownHandler);i.keyup(u.keyupHandler)});if(r.length>0)o.show(0,false,true)},keydownHandler:function(e){i.push(e.keyCode);if(!s.shortcuts)return;if(s.shortcuts.next&&s.shortcuts.next.length>0&&u.keydown.apply(null,s.shortcuts.next)){o.next();return false}if(s.shortcuts.previous&&s.shortcuts.previous.length>0&&u.keydown.apply(null,s.shortcuts.previous)){o.previous();return false}if(s.shortcuts.reset&&s.shortcuts.reset.length>0&&u.keydown.apply(null,s.shortcuts.reset)){o.reset();return false}},keyupHandler:function(e){var t=i.length;while(t--){if(i[t]===e.keyCode){i.splice(t,1)}}},keydown:function(){var t=false;e.each(arguments,function(n,r){if(typeof r==="number"){if(i.length!==1)return;if(e.inArray(r,i)>=0){t=true;return false}}else{if(r.length!==i.length)return;var s=0;e.each(r,function(t,n){if(e.inArray(n,i)>=0)s++});if(s===r.length){t=true;return false}}});return t},resetInput:function(t,n){var r=e(n);r.val(r.attr("value"))},resetTextarea:function(t,n){var r=e(n);r.val(r.html())},resetSelect:function(t,n){var r=e(n);var i=r.find("option[selected]").attr("value");r.val(i)},getField:function(e){var t=e.prop("nodeName").toLowerCase();var n=e.find("input, textarea, select");if(t==="input"||t==="textarea"||t==="select")return e;if(n.length>0)return n.eq(0);return n},eventIsSet:function(e,t){return!t&&s.events&&s.events[e]&&typeof s.events[e]==="function"}};e.fn.promin=function(e){if(o[e]){return o[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return u.init.apply(this,arguments)}return this}})(jQuery)